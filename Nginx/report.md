# Лабораторная работа №1

- [Задание](#задание)
- [Установка NGINX](#установка-nginx)
- [Настройка виртуальных хостов](#настройка-виртуальных-хостов)
- [Добавление контента](#добавление-контента)
- [SSL](#ssl)
- [Проверяем работу нашего веб-сервера]("проверяем-работу-нашего-веб-сервера)
- [Создаем псевдонимы путей к файлам (Alias)](#создаем-псевдонимы-путей-к-файлам-(alias))
- [Выводы](#выводы)

## Задания:

Настроить Nginx по заданному тз:
1. Должен работать по https c сертификатом
2. Настроить принудительное перенаправление HTTP-запросов (порт 80) на HTTPS (порт 443) для обеспечения безопасного соединения.
3. Использовать alias для создания псевдонимов путей к файлам или каталогам на сервере.
4. Настроить виртуальные хосты для обслуживания нескольких доменных имен на одном сервере.

## Установка NGINX

> Перед началом уточним, что работаем мы на ОС **Ubuntu 24.04 LTS**. Теперь можем начинать!

* Открываем терминал и при помощи команды `sudo apt-get install nginx` устанавливаем NGINX.  
* Если нас просят продолжить - соглашаемся.  
* NGINX установлен!  

* После установки проверяем статус работы NGINX при помощи команды `sudo systemctl status nginx`.

![image](https://github.com/user-attachments/assets/4ae205bc-487d-40c9-86d0-58124e953f50)


* Если статус **inactive (dead)**, запустите NGINX вручную с помощью команды `sudo systemctl start nginx`.  
* NGINX автоматически запускается во время загрузки сервера.  
* Чтобы отключить автозапуск, введите `sudo systemctl disable nginx`.  
* Чтобы возобновить автозапуск сервиса, введите `sudo systemctl enable nginx`.
* Также проверим работу нашего NGINX с локального хоста.

![image](https://github.com/user-attachments/assets/c2d52b67-e381-4358-b391-69df4d27122c)


## Настройка виртуальных хостов

> Перед настройкой виртуальных хостов вкратце опишем три основные директории, с которыми мы будем работать, для конфигурации Nginx.

`/etc/nginx/` - тут содержится основной конфигурационный файл Nginx `nginx.conf`.

`/etc/nginx/sites-available/` - это директория для хранения конфигураций отдельных сайтов (виртуальных хостов).

`/var/www/"yourdomain.ru"` - директория, где хранятся файлы сайта — HTML, CSS, JS, PHP и прочее содержимое, которое будет отдавать Nginx пользователю по запросу.


* Прежде чем создать виртуальный хост, нужно создать директорию для сайта, в которой будут размещены все необходимые файлы. По умолчанию в Ubuntu включен один виртуальный хост NGINX, который обслуживает документы из каталога `/var/www/html`. Чтобы добавить еще один домен, необходимо создать директорию в `/var/www`.
* Создадим директории для наших сайтов при помощи команд `sudo mkdir -p /var/www/dogs/html` и `sudo mkdir -p /var/www/cat/html`. Контент для сайтов мы добавим чуть позже.
* А теперь давайте перейдем к директории `/etc/nginx/sites-available`, где создадим файлы-конфигурвции для наших сайтов. При помощи команды `sudo nano /etc/nginx/sites-available/dogs.conf` создаем файл-конфигурацию для нашего сайта и сразу же настраиваем его. По аналогии проделываем те же операции для второго сайта.

![image](https://github.com/user-attachments/assets/256c1507-5bdb-49ac-846c-6e7299b6af5a)


* В первом блоке **server** мы прописали: `listen 80;` - что сервер ждет запорсы пользователей на порту `80`, `server_name cats.local;` - теперь веб-сервер будет ожидать запросы, адрисованные к этому домену, `location /` - `root /var/www/...;` - путь к файлам сайта. Когда придет запрос, NGINX будет искать файлы для сайта в этой дериктории/ `index index.html;` - название главного html файла (его мы добавим чуть позже). `return 301 https://...;` - редирект с http на https соединение.
* Второй блок **server** отличается лишь тем что мы добавили две новые строчки, отвечающие за безопасное соединение с сервером по SSL. Сами ключи и сертификаты мы добави чуть позже.

* Давайте также для удобства тестирования сделаем следующее. Откроем файл `/etc/hosts` и присвоим нашим доменам IP-адресс локального хоста.

![image](https://github.com/user-attachments/assets/743fe1b8-3ec4-4e2b-aaa0-ba561af282b1)

## Добавление контента

* Создадим для наших сайтов **index.html** файлы при помощи команды `sudo nano /var/www/dogs/html/index.html` для первого сайта, `sudo nano /var/www/cats/html/index.html` - для второго. Пример верстки:
```
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Котики</title>
    <style>
        body {
            background-color: #fff8f0;
            font-family: monospace;
            text-align: center;
            padding-top: 30px;
            color: #333;
        }
        pre {
            font-size: 14px;
            line-height: 1.1;
        }
    </style>
</head>
<body>
    <h1>Добро пожаловать в мир котиков! </h1>
    <pre>
 /\     /\
{  `---'  }
{  O   O  }
~~>  V  <~~
 \  \|/  /
  `-----'____
  /     \    \_
 {       }\  )_\_   _
 |  \_/  |/ /  \_\_/ )
  \__/  /(_/     \__/
    (__/
    </pre>
    <p>Мяу! Здесь уютно, пушисто и спокойно </p>
</body>
</html>

```

## SSL

* Как мы и обещали раньше, займемся вопросом SSL-сертификатов. Пойдем по пути наименьшего сопротивления и создадим самоподписанные сертифкаты при помощи утилиты OpenSSL. Следуем шагам
* Шаг 1 - устанавливаем нашу утилиту
  ```
  sudo apt update
  sudo apt install openssl
  ```
* Шаг 2 - Создаем самоподписный сертификат и приватный ключ. Описывать что значит каждый из параметров не видем смысла, поэтому остановимся на самых важных `-keyout` - куда сохраняем приватный ключ, `-out` - куда сохраняем сертификат.
```
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/ssl/private/dogs.key \
  -out /etc/ssl/certs/dogs.crt
```
* Шаг 3 - вовзращаемся к файлу конфигуратору и прописываем пути к нашему ключу и сертификату.

![image](https://github.com/user-attachments/assets/e18e46d0-b9e0-4d5f-bbf5-a390d67ac8aa)


## Проверяем работу нашего веб-сервера

* Активируем виртуальный хост - `sudo ln -s /etc/nginx/sites-available/dogs.conf /etc/nginx/sites-enabled/` (то же самое для второго сервера).
* Проверяем конфигурацию - `sudo nginx -t`.
* Если нет ошибок, то перезапускаем NGINX - `sudo systemctl reload nginx`.
* Заходим в браузер и пробуем достучаться до сайта - `http://cats.local`.
* Если все работает, нас должно перебросить на https соединение.

![image](https://github.com/user-attachments/assets/bc60ee04-892a-448b-9aa9-4eb10bf04589)


## Создаем псевдонимы путей к файлам (Alias)

* Создадим дополнительные директории с ещё одним html файлом. Чтобы каждый раз не прописывать полный путь к нему, создадим alias. В новом блоке location определим сокращение нашего пути в директории с новым файлом.

![image](https://github.com/user-attachments/assets/4d783f5b-1268-409a-a945-4c58da02c695)

* Проверяем результат работы:
* 
![image](https://github.com/user-attachments/assets/c4b0be10-4475-416b-bbce-027e311d20af)

## Что в итоге?

* Мы изучили процесс установки и управления веб-сервером **NGINX** на **Ubuntu**;
* Мы настроили NGINX так, чтобы он использовал самоподписанный **SSL-сертификат**, что позволило обеспечить защищенные соединения по протоколу **HTTPS**;
* Настроили принудительный редиректа всех **HTTP-запросов** на **HTTPS-запросы**, чтобы пользователи всегда взаимодействовали с сервером через защищенное соединение;
* Благодаря конфигурации виртуальных хостов мы смогли настроить несколько доменов на одном сервере;
* Мы настроили **alias** для упрощения доступа к файлам;

